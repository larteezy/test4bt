/*
 Navicat Premium Data Transfer

 Source Server         : localhost_5432
 Source Server Type    : PostgreSQL
 Source Server Version : 120002
 Source Host           : localhost:5432
 Source Catalog        : test4bt
 Source Schema         : public

 Target Server Type    : PostgreSQL
 Target Server Version : 120002
 File Encoding         : 65001

 Date: 17/08/2020 10:11:38
*/


-- ----------------------------
-- Sequence structure for order_products_op_id_seq
-- ----------------------------
DROP SEQUENCE IF EXISTS "public"."order_products_op_id_seq";
CREATE SEQUENCE "public"."order_products_op_id_seq" 
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
CACHE 1;

-- ----------------------------
-- Sequence structure for orders_order_id_seq
-- ----------------------------
DROP SEQUENCE IF EXISTS "public"."orders_order_id_seq";
CREATE SEQUENCE "public"."orders_order_id_seq" 
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
CACHE 1;

-- ----------------------------
-- Sequence structure for products_id_seq
-- ----------------------------
DROP SEQUENCE IF EXISTS "public"."products_id_seq";
CREATE SEQUENCE "public"."products_id_seq" 
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
CACHE 1;

-- ----------------------------
-- Table structure for order_products
-- ----------------------------
DROP TABLE IF EXISTS "public"."order_products";
CREATE TABLE "public"."order_products" (
  "op_id" int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY (
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
),
  "order_id" int8 NOT NULL,
  "product_id" int8 NOT NULL,
  "product_count" int4 NOT NULL DEFAULT 1
)
;
COMMENT ON COLUMN "public"."order_products"."op_id" IS 'ID связи товара с заказом';
COMMENT ON COLUMN "public"."order_products"."order_id" IS 'ID заказа';
COMMENT ON COLUMN "public"."order_products"."product_id" IS 'ID товара';
COMMENT ON COLUMN "public"."order_products"."product_count" IS 'Количество данного товара в заказе';

-- ----------------------------
-- Records of order_products
-- ----------------------------
INSERT INTO "public"."order_products" VALUES (1, 2, 1, 1);
INSERT INTO "public"."order_products" VALUES (2, 2, 7, 2);
INSERT INTO "public"."order_products" VALUES (8, 3, 7, 1);
INSERT INTO "public"."order_products" VALUES (9, 5, 6, 1);
INSERT INTO "public"."order_products" VALUES (10, 5, 1, 1);

-- ----------------------------
-- Table structure for orders
-- ----------------------------
DROP TABLE IF EXISTS "public"."orders";
CREATE TABLE "public"."orders" (
  "order_id" int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY (
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
),
  "dt_add" date NOT NULL DEFAULT CURRENT_DATE,
  "price" numeric(10,2) NOT NULL DEFAULT 0,
  "status" int2 NOT NULL DEFAULT 1
)
;
COMMENT ON COLUMN "public"."orders"."order_id" IS 'ID заказа';
COMMENT ON COLUMN "public"."orders"."dt_add" IS 'Дата создания заказа';
COMMENT ON COLUMN "public"."orders"."price" IS 'Сумма товаров заказа';
COMMENT ON COLUMN "public"."orders"."status" IS 'Статус заказа:
1 - Заказ создан
2 - Заказ оплачен';

-- ----------------------------
-- Records of orders
-- ----------------------------
INSERT INTO "public"."orders" VALUES (3, '2020-08-16', 3.00, 2);
INSERT INTO "public"."orders" VALUES (5, '2020-08-16', 0.00, 1);
INSERT INTO "public"."orders" VALUES (4, '2020-08-16', 0.00, 2);
INSERT INTO "public"."orders" VALUES (2, '2020-08-05', 12.00, 3);

-- ----------------------------
-- Table structure for products
-- ----------------------------
DROP TABLE IF EXISTS "public"."products";
CREATE TABLE "public"."products" (
  "product_id" int8 NOT NULL GENERATED BY DEFAULT AS IDENTITY (
INCREMENT 1
MINVALUE  1
MAXVALUE 9223372036854775807
START 1
),
  "name" varchar(255) COLLATE "pg_catalog"."default" NOT NULL DEFAULT 'Unknown'::character varying,
  "price" numeric(10,2) NOT NULL DEFAULT 0,
  "count" int4 NOT NULL DEFAULT 0
)
;
COMMENT ON COLUMN "public"."products"."product_id" IS 'ID товара';
COMMENT ON COLUMN "public"."products"."name" IS 'Название товара';
COMMENT ON COLUMN "public"."products"."price" IS 'Цена товара';
COMMENT ON COLUMN "public"."products"."count" IS 'Кол-во товаров';

-- ----------------------------
-- Records of products
-- ----------------------------
INSERT INTO "public"."products" VALUES (2, 'Карандаш', 12.00, 12);
INSERT INTO "public"."products" VALUES (6, 'Пенал', 4.00, 4);
INSERT INTO "public"."products" VALUES (7, 'Кокосик :о', 123.00, 10000);
INSERT INTO "public"."products" VALUES (1, 'Ручка', 12.00, 0);

-- ----------------------------
-- Alter sequences owned by
-- ----------------------------
ALTER SEQUENCE "public"."order_products_op_id_seq"
OWNED BY "public"."order_products"."op_id";
SELECT setval('"public"."order_products_op_id_seq"', 11, true);

-- ----------------------------
-- Alter sequences owned by
-- ----------------------------
ALTER SEQUENCE "public"."orders_order_id_seq"
OWNED BY "public"."orders"."order_id";
SELECT setval('"public"."orders_order_id_seq"', 6, true);

-- ----------------------------
-- Alter sequences owned by
-- ----------------------------
ALTER SEQUENCE "public"."products_id_seq"
OWNED BY "public"."products"."product_id";
SELECT setval('"public"."products_id_seq"', 8, true);

-- ----------------------------
-- Indexes structure for table order_products
-- ----------------------------
CREATE UNIQUE INDEX "order_products_op_id_idx" ON "public"."order_products" USING btree (
  "op_id" "pg_catalog"."int8_ops" ASC NULLS LAST
);

-- ----------------------------
-- Uniques structure for table order_products
-- ----------------------------
ALTER TABLE "public"."order_products" ADD CONSTRAINT "order_products_order_id_product_id_key" UNIQUE ("order_id", "product_id");

-- ----------------------------
-- Checks structure for table order_products
-- ----------------------------
ALTER TABLE "public"."order_products" ADD CONSTRAINT "checkProductCount" CHECK (product_count >= 1);

-- ----------------------------
-- Primary Key structure for table order_products
-- ----------------------------
ALTER TABLE "public"."order_products" ADD CONSTRAINT "order_products_pkey" PRIMARY KEY ("op_id");

-- ----------------------------
-- Indexes structure for table orders
-- ----------------------------
CREATE UNIQUE INDEX "orders_order_id_idx" ON "public"."orders" USING btree (
  "order_id" "pg_catalog"."int8_ops" ASC NULLS LAST
);

-- ----------------------------
-- Checks structure for table orders
-- ----------------------------
ALTER TABLE "public"."orders" ADD CONSTRAINT "checkStatus" CHECK (status = ANY (ARRAY[1, 2, 3]));
ALTER TABLE "public"."orders" ADD CONSTRAINT "сheckPrice" CHECK (price >= 0::numeric);

-- ----------------------------
-- Primary Key structure for table orders
-- ----------------------------
ALTER TABLE "public"."orders" ADD CONSTRAINT "orders_pkey" PRIMARY KEY ("order_id");

-- ----------------------------
-- Indexes structure for table products
-- ----------------------------
CREATE UNIQUE INDEX "products_id_idx" ON "public"."products" USING btree (
  "product_id" "pg_catalog"."int8_ops" ASC NULLS LAST
);

-- ----------------------------
-- Checks structure for table products
-- ----------------------------
ALTER TABLE "public"."products" ADD CONSTRAINT "checkСount" CHECK (count::numeric >= 0::numeric);
ALTER TABLE "public"."products" ADD CONSTRAINT "checkPrice" CHECK (price >= 0::numeric);

-- ----------------------------
-- Primary Key structure for table products
-- ----------------------------
ALTER TABLE "public"."products" ADD CONSTRAINT "products_pkey" PRIMARY KEY ("product_id");

-- ----------------------------
-- Foreign Keys structure for table order_products
-- ----------------------------
ALTER TABLE "public"."order_products" ADD CONSTRAINT "order_id" FOREIGN KEY ("order_id") REFERENCES "public"."orders" ("order_id") ON DELETE CASCADE ON UPDATE RESTRICT;
ALTER TABLE "public"."order_products" ADD CONSTRAINT "product_id" FOREIGN KEY ("product_id") REFERENCES "public"."products" ("product_id") ON DELETE CASCADE ON UPDATE RESTRICT;
